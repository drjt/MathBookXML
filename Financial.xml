<?xml version="1.0" encoding="UTF-8" ?>

<!-- <!DOCTYPE webwork SYSTEM "../schema/dtd/webwork.dtd">
-->
<!-- Overall element for a Mathbook XML document; mandatory, always-->
<mathbook>

    <!--
    "docinfo" is like metadata, it mostly migrates
    various places, or gets used multiple times  -->
    <docinfo>
        <!-- There can be several authors here -->
        <author>
            <personname>John Travis</personname>
            <department>Department of Mathematics</department>
            <institution>Mississippi College<br />Clinton, MS, USA</institution>
            <email>travis@mc.edu</email>
        </author>
        <!-- Could set date manually or use the "today" element 
        <date><today /></date>  -->
        <!--
        TeX/LaTeX macros can be written in the usual way.
        Whitespace and line breaks are irrelevant here.
        -->
        <macros>
        \newcommand{\definiteintegral}[4]{\int_{#1}^{#2}\,#3\,d#4}
        \newcommand{\indefiniteintegral}[2]{\int#1\,d#2}
        \newcommand{\SUM}[3]{\sum_{#1}^{#2} #3  }
        </macros>
    </docinfo>

    <!--
    The article element is top-level for anything short of a book.
    There is a book element, which is not demonstrated here.
    The "filebase" attribute is used for the filename of the
    HTML output, s part of a chunking scheme that is not complete.
    -->
    <article xml:id="FinancialMath">
        <title>Mathematics of Finance</title>

        <section xml:id="Introduction">
            <title>Introduction</title>
            
            <p>
            In today’s world, money can be used for a number of purposes. For this set of notes, we will be concerned with the use
            of money as an investment. In general, when one has monetary resources then they can use those resources to purchase supplies,
            equipment, manpower, etc. in order to generate goods and services for which others will pay. That is, they can use the money to
            make money.</p>
            <p>When one however takes a sum of money and allows someone else to use it then they forgo the opportunities described above and
            therefore incurs a loss of the opportunity to earn revenue on those funds. In order to compensate the person lending the money for
            that potential loss, an additional sum of money is added to the amount when the funds are eventually repaid. This additional sum is what
            we call interest. 
            </p>   
            <p>Some communities may have a general negative attitude for charging interest on loans. It is certainly acceptable for one to lend
            money out and not expect or require interest when repaid. Indeed, is is acceptable for one to just give money away to those that they
            might choose to do so. Actually, when lending money to friends it might be best to just consider the loan a gift and repayment a blessing
            since many friendships have been destroyed over the lack of repayment or the terms of repayment for borrowed funds.
            </p>
            <p>For these notes, we will cover the case for how to properly calculate interest on loans and leave it to the
            reader regarding whether they want to use these mathematical formulas or not.
            </p>
            <subsection>
            	<title>Notation:</title>
            	<p>For the purposes of these notes, we will use the following notations:</p>
				<ul>
					<li>Original Amount Borrowed = Principle = <m>P</m></li>
					<li>Future Amount to be Repaid = Future Value = <m>A</m></li>
					<li>Amount Earned = Interest = <m>I</m></li>
					<li>Time of investment in years = <m>t</m></li>
					<li>Interest Rate per year = <m>i</m></li>
					<li>Interest Rate per compounding period = <m>r</m></li>
					<li>Number of compounding periods per year = <m>m</m></li>					
					<li>Total Number of compounding periods = <m>n</m></li>
					<li>Payout per compounding period = <m>R</m></li>
					<li>Maturity Value = <m>MV</m></li>
				</ul>
				<p>These terms will be described more completely below</p>
			</subsection>	
		</section>

<!--
<html>
<input>
<iframe height="600" src="https://hosted2.webwork.rochester.edu/webwork2/html2xml?
&answersSubmitted=0
&sourceFilePath=Library/Rochester/setAlgebra01RealNumbers/lhp1_31-34_mo.pg
&problemSeed=123567890
&displayMode=MathJax
&courseID=daemon_course
&userID=daemon
&course_password=daemon
&outputformat=simple" width="540">
</iframe>
</input>
</html>
						http://math.mc.edu/webwork2/mathbook/financial/?effectiveUser=practice9&user=practice9
-->			
		<section xml:id="Interest"><title>Interest</title>			
			<subsection>
				<title>Simple Interest</title>
				<p>To determine the amount of interest one should pay for the use of someone else’s 
				money, one model is to base that
				amount of interest to that it is directly proportional to the length of time 
				over which the money is lent as well as directly
				proportional to some rate which is based upon the borrower’s perceived 
				ability to repay and based upon current market conditions.
				Often, when dealing with monetary value over time one can more easily illustrate
				the setting using a time line
					<me>
						\begin{matrix}
						 \text{Money Amounts} &amp; P &amp;  \rightarrow &amp; A \\ 
						  \hline \\
						  \text{Time} &amp;  0  &amp; \rightarrow &amp;  t 
						\end{matrix}					
					</me>
				
				To satisfy these constraints leads to the model for Simple Interest. </p>
				<theorem><title>Simple Interest Formula</title>
					<statement>Using simple interest, <m>I = P \cdot i \cdot t</m> and so <m>A = P + P \cdot i \cdot t</m> or <m>A = P(1 + i \cdot t)</m></statement>
				</theorem>
			</subsection>
			
			<subsection>
				<title>Compound Interest</title>
				<p>When using simple interest, one only considers the value of the resource at the beginning of time and then again at the end. H
				owever, the lender does without use of the funds at all times during the period of the investment. Indeed, if the original investment
				were to only be lent for 1/2 of the original time period, then the borrower would have to pay the accrued interest at that time (1/2 as much
				as planned) and then perhaps re-borrow the money plus the paid interest for the remaining time. However, for the second half, the amount borrowed
				would include the additional interest that had to be paid.  Continuing this by shortening the period (say, 1/4’s or 1/12’s) would allow
				for the amount borrowed at the end of each period to grow. The net effect of this recalculation over many periods gives rise to what is 
				know as Compound Interest.</p>
				<theorem><title>Future Value of Compound Interest</title>
					<statement><p>Using Compound interest over t years, compounding m times per year, 
					yields <m>\displaystyle A = P(1+r)^n</m> with <m>n=mt</m> and <m>r = i/m</m></p>
					</statement>
					<proof>
					<p>To determine the future value of a deposit of size <m>P</m> over several 
					periods, utilize the simple interest formula for a single
					period to determine the value of the deposit after that one period. Then, 
					take that new (slightly larger) amount as a starting point
					for a new simple interest calculation covering the next period. Repeat 
					for n periods to get the ending value over all periods.</p>
					<p>To do this, let’s denote the present value after k periods as 
					<m>P_k</m> and note that <m>P_0 = P</m>.</p>
					<me>
\begin{matrix}
 \text{Money Amounts} &amp; P_0 &amp; P_1 &amp; P_2 &amp; \ldots &amp; P_n \\ 
  \hline \\
  \text{Time} &amp;  0  &amp; \frac{t}{n} &amp; \frac{2t}{n} &amp; \ldots &amp; t \\ 
\end{matrix}					
					</me>
					<p>Then, using simple interest over each single time period</p>
					<md>
						<mrow>P_1 &amp; = P_0(1+r)</mrow>
						<mrow>P_2 &amp; = P_1(1+r) = P_0(1+r)^2 </mrow>
						<mrow>P_3 &amp; = P_2(1+r) = P_0(1+r)^3</mrow>
						<mrow>P_4 &amp; = P_3(1+r) = P_0(1+r)^4</mrow>
						<mrow> &amp; =  ...</mrow>
						<mrow>P_{n-1} &amp; = P_{n-2}(1+r) = P_0(1+r)^{n-1}</mrow>
						<mrow>P_n &amp; = P_{n-1}(1+r) = P_0(1+r)^n</mrow>
					</md>
					<p>Noting that <m>A = P_n </m> and <m>P = P_0 </m> gives</p>
					<md>
						<mrow>A &amp; = P(1+r)^n</mrow>
					</md>
					</proof>
				</theorem>
				
				<corollary><title>Present Value of Compound Interest</title>
					<statement>Given a future value <m>A</m>, the present value using Compound Interest is given by <m>\displaystyle P = A(1+r)^{-n}</m></statement>
					<proof><p>Take the formula above and solve for P. This gives,</p>
						<p><m>\displaystyle P = A(1+r)^{-n}</m></p>
					</proof>
				</corollary>
				
				<subsection>
					<title>Effective Interest Rates</title>
					<p>The published yearly interest rate is also called the “nominal” rate.
					As one considers investments (and especially annuities) one may desire compounding the value of money over different compounding time 
					frames. So, comparing raw interest rates becomes muddled since the same nominal rate can result in wildly different actual growth amounts.
					To avoid confusion we determine what is known as an effective interest rate
					by computing the increase of <m>\$ 1</m> over one year’s time span. This results in the effective rate <m>r_e</m></p>
					<md>
						<mrow>P + I = 1 + 1 \cdot r_e \cdot 1 = 1(1+r)^m</mrow>
						<mrow>r_e = (1+r)^m - 1</mrow>
					</md>
					<example><title>Comparing different compounding periods</title>
						<p>Determine the effective rate of compounding daily that is equivalent to compounding monthly at an annual rate of <m>r_{12}=4%</m>.  
						To do so, first compute the effective interest rate of the monthly compounding (since you know its stated rate) using 
						<m> \displaystyle (1+ \frac{0.04}{12})^{12} - 1</m>.  Then, use the effective rate
						formula set equal to this effective value and work your way backward to find the annual rate <m>r_{365}</m>for compounding daily.</p>
						<md>
							<mrow>(1+ \frac{0.04}{12})^{12} - 1 &amp; = (1+ \frac{r_{365}}{365})^{365} - 1 </mrow>
							<mrow>(1+ \frac{0.04}{12})^{12} &amp; = (1+ \frac{r_{365}}{365})^{365} </mrow>
							<mrow>\ln(1+ \frac{0.04}{12})^{12} &amp; = \ln(1+ \frac{r_{365}}{365})^{365} </mrow>
							<mrow>12 \ln(1+ \frac{0.04}{12}) &amp; = 365 \ln(1+ \frac{r_{365}}{365}) </mrow>
							<mrow>\frac{12}{365} \ln(1+ \frac{0.04}{12}) &amp; = \ln(1+ \frac{r_{365}}{365}) </mrow>
							<mrow>e^{\frac{12}{365} \ln(1+ \frac{0.04}{12})} &amp; = 1+ \frac{r_{365}}{365} </mrow>
							<mrow>365(e^{\frac{12}{365} \ln(1+ \frac{0.04}{12})} - 1) &amp; = r_{365} </mrow>
						</md>
						<p>and the rest is arithmetic.  Easily, the above example generalizes to other compounding periods:</p>
						<md>
							<mrow>(1+ \frac{r_1}{m_1})^{m_1} - 1 &amp; = (1+ \frac{r_2}{m_2})^{m_2} - 1 </mrow>
							<mrow>(1+ \frac{r_1}{m_1})^{m_1} &amp; = (1+ \frac{r_2}{m_2})^{m_2} </mrow>
							<mrow>\ln(1+ \frac{r_1}{m_1})^{m_1} &amp; = \ln(1+ \frac{r_2}{m_2})^{m_2} </mrow>
							<mrow>m_1 \ln(1+ \frac{r_1}{m_1}) &amp; = m_2 \ln(1+ \frac{r_2}{m_2}) </mrow>
							<mrow>\frac{m_1}{m_2} \ln(1+ \frac{r_1}{m_1}) &amp; = \ln(1+ \frac{r_2}{m_2}) </mrow>
							<mrow>e^{\frac{m_1}{m_2} \ln(1+ \frac{r_1}{m_1})} &amp; = 1+ \frac{r_2}{m_2} </mrow>
							<mrow>m_2(e^{\frac{m_1}{m_2} \ln(1+ \frac{r_1}{m_1})} - 1) &amp; = r_2 </mrow>
						</md>
					</example>
				</subsection>

				<subsection>
					<title>Continuous Compounding of Interest</title>
					<p>As interest is compounded more often, the effective interest rate tends to increase. Indeed, as m increases then the time between
					periods decreases and becomes infinitesimal.  We would then say that interest is compounded continuously. As it turns out, we will 
					see that there is a limit to the effective rate as m grows.</p>
					
					<theorem><title>Future Value when Compounding Continuously</title>
						<statement><m>\displaystyle A = P e^{it}</m></statement>
						<proof>
							<md>
								<mrow>A &amp; = P \lim_{m \rightarrow \infty} (1+i/m)^{m t}</mrow>
								<mrow>  &amp; = P \lim_{m \rightarrow \infty} \left ( (1+i/m)^m \right )^t</mrow>
								<mrow>  &amp; = P \lim_{m \rightarrow \infty} \left ( e^{ \ln(1+i/m)^m} \right )^t</mrow>
								<mrow>  &amp; = P \lim_{m \rightarrow \infty} \left ( e^{m \cdot \ln(1+i/m)} \right )^t</mrow>
								<mrow>  &amp; = P \lim_{m \rightarrow \infty} \left ( e^{\frac{ \ln(1+i/m)}{1/m}} \right )^t</mrow>
								<mrow>  &amp; = P \lim_{m \rightarrow \infty} \left ( e^{\frac{ \frac{-i/m^2}{(1+i/m)}}{-1/m^2}} \right )^t</mrow>
								<mrow>  &amp; = P \lim_{m \rightarrow \infty} \left ( e^{ \frac{i}{(1+i/m)}} \right )^t</mrow>
								<mrow>  &amp; = P \left ( e^{ \frac{i}{1+0}} \right )^t</mrow>
								<mrow>  &amp; = P e^{i \cdot t}</mrow>
							</md>
						</proof>
					</theorem>
					
					<sage>
					  <input>
var('t')
@interact
def _(rate = slider(1,12,1),m = slider(2,1000,2),end_time=(1,20,1)):
    
    n = m*t
    discrete_compounding = (1+rate/m)^n
    continuous_compounding = e^(rate*t)
    G = plot(discrete_compounding,t,0,end_time)
    G += plot(continuous_compounding,t,0,end_time,color='green')
    G.show(title='Discrete vs Continuous')
    H = plot(continuous_compounding-discrete_compounding,t,0,end_time,color='red')
    H.show(title='Difference between the two',figsize=(5,4))
						</input>
					</sage>
				</subsection>
			</subsection>
		</section>
		<section xml:id="Annuities"><title>Annuities</title>
			<subsection>
				<title>Annuities</title>
				<p>In the discussion above, investments considered a single “deposit” at the beginning of the time period and a single “payout” at the 
				end of the time period. In many real-life situations, one may desire an option where there is perhaps a single deposit at the beginning of 
				time and then a series of (perhaps equal) payouts over the time period. Such a sequence of payments is called an annuity.</p>
				
				<theorem><title>Annuity Future Value </title>
					<statement>An annuity of R per period over t years, paying out m times per year with yearly rate i yields 
					<m>\displaystyle A = R\frac{(1+r)^n-1}{r}</m></statement>
					<proof>
					<p>We will presume this sequence of regular and equal payments of amount R starts in 1 period from the beginning of time 
					and then ends on the last day of the allotted time period.  To determine the future value of this accumulated promise, take
					each payment and find its future value at the end of the time period.  Note that this means the first payment must be “moved forward”
					n-1 time periods, the second n-2 time periods, etc. until the last payment which is actually at the final time and so is not moved
					at all. This gives</p>
					<md>
						<mrow>A &amp; = R(1+r)^{n-1} + R(1+r)^{n-2} + R(1+r)^{n-3} +  ...  R(1+r)^{1} + R</mrow>
						<mrow> &amp; = R \left [ (1+r)^{n-1} + (1+r)^{n-2} + (1+r)^{n-3} +  ...  (1+r)^{1} + 1 \right ]</mrow>
						<mrow> &amp; = R \displaystyle \frac{1-(1+r)^n}{1-(1+r)} </mrow>
						<mrow> &amp; = R \displaystyle \frac{(1+r)^n-1}{r} </mrow>
					</md>
					</proof>
				</theorem>
				
				<corollary><title>Annuity Present Value </title>
					<statement>An annuity of R per period over t years, paying out m times per year with yearly rate i yields 
					<m>\displaystyle P = R\frac{1-(1+r)^{-n}}{r}</m></statement>
					<proof>
					<p>Apply the present value formula to the future value formula above.</p>
					</proof>
				</corollary>
				
			</subsection>
			<subsection>
				<title>Annuity Calculations</title>
				<subsection>
					<title>Complete Amortization Schedule</title>
					<p>To determine the breakdown regarding interest paid and reduction of principle for any given payment in an annuity, one can
					simply apply a simple interest calculation covering one period to determine the interest and then the remainder of the payment
					will be applied to reducing the principle amount owed. Continuing this process for the life of the annuity (loan) give what is 
					known as an “amortization schedule”. In general, since this involves payments in real money then we often round up the calculation
					of the regular payments so that the final payment will perhaps be slightly smaller than the others.</p>
					<sage>
						<input>
def roundup(x):
    return (ceil(100*x)/100).n()

@interact(layout=dict(top=[['P', 'rate'],[ 'm', 't']]))
def _(P = input_box(10000,label='Principle',width=12),
                    m = input_box(12,label='Compounting Periods per year',width=4),
                    t = input_box(2,label='Number of Years',width=4),
                    rate = input_box(0.04,label='Yearly Interest Rate',width=6)):
    n = m*t
    r = rate/m
    R1 = P*r/(1-(1+r)^(-n))
    R = (ceil(100*R1)/100).n()
    Bal = P    
    T = [['Payment',"Starting","Interest Paid","Principle Reduction"]]
    pretty_print(html('Monthly Payment is \( \$ %.2f \)<p></p>'%(R)))
    for k in range(n-1):
        Interest = round(Bal*r,2)
        Reduction = R - Interest
        T.append([k+1,"%7.2f"%(Bal),"%5.2f"%(Interest),"%7.2f"%(Reduction)])
        #        pretty_print(html("Pmt#$%s$: "%str(k+1)+"Starting Balance = $ %.2f$,"%Bal+" interest Owed = $%.2f$  "%(Interest)+", Payment to Principal = $%.2f$  "%(Reduction)))
        Bal = Bal - Reduction
    Interest = roundup(Bal*r)
    LastPmt = Bal+Interest
    T.append([n,"%7.2f"%(Bal),"%5.2f"%(Interest),"%7.2f"%(Bal)])
    show(table(T, header_row=True, align='right', frame=True  ))

    pretty_print(html("<p></p>Final payment of = \( \$ %.2f \)"%(LastPmt)))

						</input>
					</sage>
				</subsection>
				<subsection>
					<title>Determining directly the interest for any given payment in an annuity</title>
					<p>To determine the amount of interest in the kth payment, one can avoid having to compute the entire amortization schedule by 
					computing the present value <m>P_{mid}</m> of the final n-k payments at the previous time period. This will be at the n-(k-1
					Then, compute the interest demanded on that amount one time period later.  That is, <m>P_{mid} \cdot r </m>.</p>
					<md>
						<mrow>P_{mid} = R \frac{1-(1+r)^{-(n-(k+1))}}{r}</mrow>
						<mrow>P_{mid} \cdot r = R (1-(1+r)^{k-n-1})</mrow>
					</md>

					<sage>
						<input>
def roundup(x):
    return (ceil(100*x)/100).n()

@interact
def _(P = input_box(10000,label='Principle'),
                    m = input_box(12,label='Compounting Periods per year'),
                    t = input_box(2,label='Number of Years'),
                    rate = input_box(0.04,label='Yearly Interest Rate'),
                    k = input_box(12,label='Payment Period')):
    n = m*t
    r = rate/m
    R = roundup(P*r/(1-(1+r)^(-n)))
    Bal = P    
    pretty_print(html('Monthly Payment is $%.2f$.'%(R)))
    PsubK = R*(1-(1+r)^(k-n-1))/r
    Interest = PsubK*r
    Reduction = R - Interest
    pretty_print(html('At the $%s$th '%str(k)+'payment period, Balance = $%.2f$'%(PsubK)+' requires interest of $%.2f$'%(Interest)+' and principle reduction of $%.2f$'%(Reduction)))
						</input>
					</sage>


				</subsection>
				<subsection>
					<title>Annuity with annual cost of living increases</title>
					<p>Generally, an annuity is a sequence of equal payments over time. In reality, people like to use an annuity to
					fund retirement and one might want to allow for the payments to increase each year to keep up with the cost of living.
					Another alternative occurs perhaps when one might purchase a house and not be able to make the necessary payments at the 
					beginning of the annuity but expects to earn more and therefore be able to pay more in later years of the loan. To analyze
					these situations takes a bit more care since the compounding period and the (annual) increases are not necessarily on the 
					same time frames.  To fix this, the idea is to convert the periodic payments in terms of years by converting, for example,
					the 12 monthly payments into a single but equivalent lump sum payment at the end of the year.  So long as the lump sum payment
					is mathematically equivalent to the sequence of payments then all is equivalent. Then, we can tack on the desired cost of living 
					increase to these annualized payments and use that rate of increase for the yearly annuity.</p>
					<theorem>
						<title>Yearly Annuity with Cost of Living Adjustment</title>
							<statement>The Present Value of a yearly annuity initially in the amount of <m>R_y</m> which includes yearly cost-of-living adjustments is 
							<m>R_y \frac{1}{1+r_e} \left [ \frac{ \left ( \frac{1+a}{1+r_e} \right )^t-1}{ \left (\frac{1+a}{1+r_e} \right )-1} \right]</m>
							with <m>R_y</m> = first year’s payment, 
							<m>r_e</m> = effective yearly rate, a = yearly cost-of-living increase, t = number of years.</statement>
							<proof>
								<p>To save some time, let’s define <m>z = \frac{1+a}{1+r_e}</m>.  Notice that if the cost of living increase (a) is greater than
								the effective rate of interest <m>r_e</m> then the net investment will grow with a interest rate related to <m>z-1 \gt 0</m>.  
								On the other
								hand, if the cost of living increase is less than the effective rate of interest, then the net investment wil grow at an interest
								rate <m>z-1 \lt 0</m>...that it, your periodic payments will not be keeping up with inflation.  Notice in the formulas below that this 
								quotient z essentially replaces the standard compound growth factor (1+r). </p>
								<p>Starting with a payment of R at the end of the first
								year, increase this by a factor of (1+a) for each subsequent year gives a present value of </p>
					<md>
						<mrow>P &amp; = R_y (1+r_e)^{-1} + R_y (1+a)(1+r_e)^{-2} + R_y (1+a)^{2}(1+r_e)^{-3}  + R_y (1+a)^{3}(1+r_e)^{-4} + ... + R_y (1+a)^{t-1}(1+r_e)^{-t}</mrow>
						<mrow>&amp; = R_y \left [ (1+r_e)^{-1} + (1+a)(1+r_e)^{-2} + (1+a)^{2}(1+r_e)^{-3} + (1+a)^{3}(1+r_e)^{-4} + ... + (1+a)^{t-1}(1+r_e)^{-t} \right ]</mrow>
						<mrow>&amp; = R_y \frac{1}{1+r_e} \left [ 1 + z + z^2 + z^3 + ... +  z^{t-1} \right ]</mrow>
						<mrow>&amp; = R_y \frac{1}{1+r_e} \left [ \frac{1-z^t}{1-z} \right] </mrow>
						<mrow>&amp; = R_y \frac{1}{1+r_e} \left [ \frac{z^t-1}{z-1} \right] </mrow>
					</md>							
							</proof>		
					</theorem>
					
					<p>Obviously, one may want to receive these payments more often than once a year but account for yearly adjustments to the payments.
					In this situation, one should determine the size R of the m payments in the first year and then find the accumulated value of those 
					payments at the end of one year. Taking that value as R in the theorem above gives the present value of the cost-of-living adjusted
					annuity stream. Of course one can take that present value and determine the value of the income stream at any other desired time.</p>
					<example>
					<title>Yearly Annuity with Cost of Living Increase</title>
					<p>Let’s consider the value of making payments of <m>\$ 10</m>  per year in year one and then increasing the payments by a rate of
					a = 4% each year.  Assuming an interest rate of <m>r_e</m> = 3% compounded yearly for t = 8 years, what is the present value of this annuity?</p>
					<md>
						<mrow>z = \frac{1.04}{1.03} \approx 1.0097</mrow>
						<mrow>P &amp; \approx \$ 10 \frac{1}{1.03} \left [ \frac{1.0097^8-1}{0.0097} \right]</mrow>
						<mrow> &amp; = \$ 10 \frac{1}{1.03} 8.2769334 = \$ 80.36 </mrow>
					</md>
					</example>
					
					<example>
						<title>Monthly Annuity with Annual Cost of Living Increase</title>
						<p>To allow for more frequent payments, say monthly, but with yearly adjustments to the amount of these payments one can determine
						the future value of the initial payments over one year.  Then, use that value as a “yearly” payment adjusted for cost-of-living increase.</p>
						<p>Consider the following:  Initial monthly payments of <m>\$ 10</m> per month with interest compounded at 3% and with 4% yearly 
						cost-of-living adjustments for 8 years. First, compute the future value <m>R_y</m> of a year of payments and then apply the theorem above.</p>
						<md>
							<mrow>r_e = \left ( 1 + \frac{0.03}{12} \right )^{12}-1 \approx 0.0304159</mrow>
							<mrow>R_y = \$ 10 \frac{(1 + \frac{0.03}{12})^{12}-1}{\frac{0.03}{12}} = 121.66</mrow>
							<mrow>z = \frac{1.04}{1.0304159} \approx 1.00930119576 </mrow>
							<mrow>P = \$ 121.66 \frac{1}{1.0304159} \left [ \frac{1.00930119576^8-1}{0.00930119576} \right] = \$ 975.88</mrow>
						</md>
					</example>
					
					<example>
					<p>The interactive cell below determines the effect of compounding and cost of living increases for each payment of an annuity.</p>
					<sage>
						<input>
def round(x):
    return (floor(100*(x+0.005))/100).n()
    
@interact(layout=dict(top=[['R', 'rate'],['m','t'],['a']]))
def _(R = input_box(10,label='Yearly Payment',width=10),
           rate = input_box(0.03,label='Nominal Rate',width=6), 
           m = input_box(1,label='Periods per Year',width=4), 
           t = input_box(8,label='Years',width=4), 
           a = input_box(0.04,label='Cost-of-Living Adjustment',width=6) ):
    r = rate/m
    n = m*t
    A = 0
    for k in range(t):
        R1 = round(R*(1+a)^(k))
        print "Year ",k+1," has payment(s) of ", R1
        yearend = k*m
        print "yearend ",yearend
        for j in range(m):
            tempBeg = R1*(1+r)^(-(yearend+j+1))
            tempEnd = R1*(1+r)^(n-yearend-j-1)
            A += tempEnd
            print "  ",j+1,"th payment is worth at the start of time ",tempBeg
            print "  ",j+1,"th payment is worth at the end of time ",tempEnd
    P = A*(1+r)^(-n)
    print "Total value of payments at the start of time is ",P
    print "Total value of payments at the end of time is ",A
    					</input>
					</sage>
					</example>
				</subsection>
			</subsection>
			<subsection>
				<title>Perpetual Annuities</title>
				<p>In general, an annuity is a regular set of payments over a set period of time. However, sometimes you might want to set up an investment
				which will return a set of regular payments forever. This is called a “perpetuity” or a “perpetual annuity”. To determine the amount to invest
				to set up such an instrument, it is best to consider the present value at the beginning of time and require that the investment grow over only
				one time period to the amount which needs to be dispersed.  That is, after one period the investment grows by the amount of the desired payment:</p>
				<md>
					<mrow> A &amp; = P + R = P(1+r)</mrow>
					<mrow> R &amp; = P(1+r) - P</mrow>
					<mrow> &amp; = Pr</mrow>
				</md>
				<p>If you want to consider money compounded more often than the payment period (say yearly payments but investments compounded m times per year</p>
				<md>
					<mrow> A &amp; = P + R = P(1+r)^m</mrow>
					<mrow> R &amp; = P(1+r)^m - P</mrow>
					<mrow> &amp; = P((1+r)^m - 1)</mrow>
				</md>
				<p>So, if you want to have a set of regular payments of <m>\$ R</m>  each year, then set aside an investment of 
				<m>\displaystyle P = \frac{R}{(1+r)^m - 1}</m></p>
			</subsection>

        </section>
        
        
        <section xml:id="Bonds"><title>Bonds</title>
        	<p>A bond is a financial instrument that is often utilized to finance capital needs. Indeed, the lender often utilizes the sale of such
        	an instrument to invest in long-term productivity-increasing items.  Indeed, the bond often requires that the issuer of the bond utilized
        	the bond proceeds for some designated project. In return for the money paid to purchase the bond, the purchaser (bond-holder)
        	if promised the principle back plus interest. The rate of interest charged is often fixed but can also be variable.</p>
        	<p>Some terms:
        	<ul>
				<li>Maturity Value = Promised repayment future value</li>
				<li>Coupon = Percentage of annual interest paid during the time span of the bond.</li>
				<li>Price = Present Value of the Bond’s Maturity Value</li>
				<li>Yield = Total Interest Earned</li>
				<li>Par Bonds = An instrument in which yield equals coupon.</li>
				<li>Discount Bonds = An instrument in which the yield is greater than the coupon.</li>
				<li>Premium Bonds = An instrument in which the yield is less than the coupon.</li>
				<li>Capital Appreciation Bonds = An instrument which pays no interest until maturity.</li>
				<li>Callable Bonds = An instrument which can be redeemed by the issuer before the actual maturity date.</li>
				<li>Basis Point = one hundredth of one percent yield.</li>
				
        	</ul>
        	</p>
        	
        	<subsection><title>Interesting Facts about Bonds</title>
        	<p>Price and Yield vary in opposite directions. As the price of a bond increases, the difference between price and maturity value 
        	diminishes and therefore yield goes down. As the price decreases, the difference increases and therefore yield goes up.</p>
        	<p>Fixed rate bonds generally presume a 360-day year. Variable rate bonds presume actual days elapsed.</p>
        	</subsection>
        	
        	<p>The bond yield, which is a measure of the income generated by a bond, is calculated as the interest divided by the 
        	price. Therefore, if a <m>\$ 10,000</m> bond with 10% annual Coupons (probably broken up into two semi-annual payments of
        	<m>\$ 500</m> each) is selling at <m>\$ 10,000 </m>, or par, the coupon payment 
        	is equal to 10%, i.e. the Yield. However bond prices can be affected by market conditions and so may fluctuate. As they do
        	so does the yield. </p>
        	
        	<p>In this example, if the market price fluctuated and valued your bond to be worth <m>\$ 9,000 </m>, your yield would now 
        	be 11.11% (1000/9000), but the <m>\$ 500</m> semi-annual coupon payments would not change. Conversely, if the bond price were to 
        	shoot up to <m>\$ 11000</m>, your yield would decrease to 9.09% (1000/11000), but again, you would still receive the same 
        	<m>\$ 500 </m> semi-annual coupon payments.</p>
        	
        	<example><title>Zero Coupon Bond Purchase Price</title>
        	<p>A bond with no coupons is valued as a normal compound investment with the Maturity Value the specified future value.
        	To compute the purchase price of a 20 year <m>\$ 5000 </m> bond with yearly rate of 4.95%</p>
        	<me>P = \$ 5000 (1+0.0495)^{-20} = \$ 1173.54.</me>
        	</example>
        	
        	<theorem><title> Accumulated Value for Annual Coupon Bond</title>
        	<statement>Total Accumulated Value<m> = P(1 + r_{eff} \cdot t)</m></statement>
				<proof>
					<p>A bond with annual coupons will pay a simple interest coupon each year in the amount of <m>P \cdot r_{eff}</m>,
					 where <m>r_{eff}</m> is the effective annual interest rate.  Since the interest is paid out each year then 
					 there is no
					compounding effect and so the total value including interest of the bond follows a simple interest model with 
					Total Amount Accumulated <me> = P + P \cdot r_{eff} \cdot t = P(1 + r_{eff} \cdot t)</me>.</p>
				</proof>
        	</theorem>

        	<example>
        	<p>Consider a 20 year 9% bond with annual coupons purchased in 1998 for <m>\$ 93000</m>. The amount of each  coupon  
        	is the same <m>\$ 93000 \cdot 0.09 = \$ 8370</m>.  So, by 2012 the accumulated interest would have been 
        	<m>8370 \cdot 14</m> years = <m>\$ 117180</m>.  For the entire length of the bond, the total amount accumulated by 2018
        	would be <m>\$ 93000(1+0.09 \cdot 20) = \$ 260,400 </m>.</p>
        	</example>

			<subsection><title>Pricing Bonds</title>        	
				<theorem><title>Setting price of bond with periodic coupons.</title>
				<statement>Given a bond with stated rate of <m>r_{bond}</m>, nominal rate of <m>r_{nom}</m>maturity (face) value of <m>MV</m>, and 
				which matures in t years with coupons provided m times a year, the purchase price is given by
				<me>MV (1+\frac{r_{nom}}{m})^{-n} + MV \cdot \frac{r_{bond}}{m} \cdot \frac{1-(1+\frac{r_{nom}}{m})^{-n}}{\frac{r_{nom}}{m}}</me>
				</statement>
				<proof>
					<p>The yearly coupon value equals <m>MV \cdot r_{bond}</m> 
					broken up into m payments of size <m>R = MV \frac{r_{bond}}{m}</m>.  These coupons can be thought of as a regular 
					annuity with <m>n = m \cdot t</m> payments and finding the present value of these yields the second part of this
					formula.</p>
					<p>The maturity value also is factored into the price by using the compound interest formulas with the nominal rate
					and moving back n periods to the time when the bond is sold. This is the first part of this formula.</p>
				</proof>
				</theorem>
			
				<corollary>
				<statement>For Bonds where bond rate = nominal rate, purchase price equals maturity value</statement>
				<proof>
					<p>In this case, <m>r_{nom} = r_{bond} = r</m> gives</p>
					<md>
					<mrow> P &amp; = MV (1+\frac{r}{m})^{-n} + MV \cdot \frac{r}{m} \cdot \frac{1-(1+\frac{r}{m})^{-n}}{\frac{r}{m}}</mrow>
					<mrow> &amp; = MV \left ( (1+\frac{r}{m})^{-n} + \frac{r}{m} \cdot \frac{1-(1+\frac{r}{m})^{-n}}{\frac{r}{m}}[ \right ] </mrow>
					<mrow> &amp; = MV \left ( (1+\frac{r}{m})^{-n} + 1-(1+\frac{r}{m})^{-n}[ \right ] </mrow>
					<mrow> &amp; = MV \cdot 1 = F</mrow>
					</md>
				</proof>
				</corollary>
			
				<example>
				<p>A 14% bond with semiannual coupons, face value of <m>MV = \$ 40,000,000</m> for 25 years and with nominal annual 
				rate of 10%.</p>
				<md>
					<mrow>n &amp; = 25 \cdot 2 = 50</mrow>
					<mrow>s &amp; = \frac{1-(1+\frac{0.10}{2})^{-50}}{\frac{0.10}{2}}</mrow>
					<mrow>\text{Price On Issue Date} &amp; = \$ 40000000(1+\frac{0.10}{2})^{-50} + \$40000000 \cdot \frac{0.14}{2} \cdot s</mrow>
					<mrow>&amp; = 3488149.08 + 2800000 \cdot 18.2559254605524</mrow>
					<mrow>&amp;  = 3488149.08 + 51116591.29 = </mrow>
				</md>
				</example>
			
				<sage>
					<input>
	@interact(layout=dict(top=[['MV'],['m','t'],['r1','r2']]))
	def _(r1 = input_box(0.10,label="nominal rate",width=6),
		  r2 = input_box(0.14,label="stated bond rate",width=6),
		  m = input_box(2,label="coupons per year",width=4),
		  t = input_box(25,label="years",width=4),
		  MV = input_box(40000,label="Bond Face Value",width=10)):
		n = t*m                       # number of periods = years?

		term = (1-(1+r1/m)^(-n))/(r1/m)
		print "Coupon Multiplier = ",term.n()
		valueCoupons = MV*r2/2 * term   # Annual coupons are the biannual payments 
		valueBondEnd = MV*(1+r1/m)^(-n) # Present value of F in 25 years
		print "Coupons Value = ",valueCoupons
		print "Redemption PV = ",valueBondEnd
		print "Purchase Price of Bond = ",valueCoupons+valueBondEnd
					</input>
				</sage>

				<p>An issuing company may choose to repurchase a bond before the bond matures and may agree to purchase it back at par value. 
				However, the bond is said to be purchased at a discount if its price is less than its redemption value. On the other hand, it 
				is purchased at a premium if its purchase price is greater than its redemption value. </p>
				<p>To determine the fair value of the bond immediately following a coupon payment, adjust the formula above for determining purchase
				price at the onset of the bond so that it focuses value at one of the time periods in the bonds life span.</p>
				<corollary><title>Book Value of a Bond</title>
				<statement>For a bond convertible m times a year and with a yield rate convertible m times a year, if the Face Value is FV and 
				Book Value is BV and Redemption Value is RV, when redeeming immediately after the kth coupon payment yields
					<me>BV = FV \cdot \frac{r_{nom}}{m} \cdot \frac{(1 - (1+\frac{r_{bond}}{m})^{-t \cdot m + k})}{\frac{r_{bond}}{m}} 
						   + RV \cdot (1+\frac{r_{bond}}{m})^{-t \cdot m + k}</me>
				</statement>
				</corollary>
				<example>
				<p> Suppose a 10 year <m> \$ 2000</m> bond earns interest at 10.2% convertible semiannually and that the yield rate is 7.1% convertible 
				semiannually.  If the redemption value immediately after the 13th coupon payment is <m>\$ 2300.00</m>, the book value BV is
				given by </p>
				<md>
					<mrow>BV = \$ 2212.70 = \$ 2000 \cdot \frac{0.102}{2} \cdot \frac{1 - (1+ \frac{0.071}{2})^{-20 + 13}}{\frac{0.071}{2}} 
					     + RV \cdot (1+\frac{0.071}{2})^{-20 + 13}</mrow>
				</md>
				</example>
				<sage>
					<input>
@interact(layout=dict(top=[['MV','k'],['m','t'],['r1','r2'],['RV']]))
def _(r1 = input_box(0.071,label="nominal rate",width=6),
	  r2 = input_box(0.102,label="stated bond rate",width=6),
	  m = input_box(2,label="coupons per year",width=4),
	  t = input_box(10,label="years",width=4),
      k = input_box(13,label="Coupon Number",width=4),
	  MV = input_box(2000,label="Bond Face Value",width=10),
	  RV = input_box(2030,label="Redemption Value at coupon number",width=10)):
	n = t*m                       
	term = (1-(1+r1/m)^(-n+k))/(r1/m)
	valueCouponsRemain = MV*r2/m * term   # Annual coupons are the m payments 
	valueMV = RV*(1+r1/m)^(-n+k) # Present value of MV
	BV = round(100*(valueCouponsRemain+valueMV))/100
	print "Book Value of Bond after the ",k,"th coupon = ",BV.n()
					</input>
				</sage>
				<corollary><title>Redemption Value of a Bond</title>
				<statement>For a bond convertible m times a year and with a yield rate convertible m times a year, if the Face Value is FV and 
				Book Value is BV and Redemption Value is RV, when redeeming immediately after the kth coupon payment yields
					<me>RV = \left [ BV - FV \cdot \frac{r_{bond}}{m} \cdot \frac{(1 - (1+\frac{r_{nom}}{m})^{-t \cdot m + k})}{\frac{r_{nom}}{m}} \right ] 
					            / (1+\frac{r_{nom}}{m})^{-t \cdot m + k} </me>
				</statement>
				</corollary>
				<sage>
					<input>
@interact(layout=dict(top=[['MV','k'],['m','t'],['r1','r2'],['BV']]))
def _(r1 = input_box(0.071,label="nominal rate",width=6),
	  r2 = input_box(0.102,label="stated bond rate",width=6),
	  m = input_box(2,label="coupons per year",width=4),
	  t = input_box(10,label="years",width=4),
      k = input_box(13,label="Coupon Number",width=4),
	  MV = input_box(2000,label="Bond Face Value",width=10),
	  BV = input_box(2212.70,label="Book Value at coupon number",width=10)):
    n = t*m                  
    
    term = (1-(1+r1/m)^(-n+k))/(r1/m)
    valueCouponsRemain = MV*r2/m * term   # Annual coupons are the m payments 
    RV = (BV - valueCouponsRemain)/(1+r1/m)^(-n+k) # Present value of MV
    RV = round(100*RV)/100
    print "Redemption Value of Bond after the ",k,"th coupon = ",RV.n()
					</input>
				</sage>
								
			</subsection>
			        	
        	<subsection><title>Calculating Current Yield</title>
				<p>The current yield CY is the return (as a percentage) of the annual coupon payment. This yield determines 
				what percentage of the actual dollar coupon payment is of the price the investor pays for the bond.</p>
				<me>CY = \$ 100 \cdot \frac{\text{Annual Interest Paid}}{\text{Market Price}}</me>
				<example>
					<p>Suppose you purchase a bond with par value <m>\$ 5000 </m> for <m>\$ 4950 </m> with a coupon rate of 4%.  Then, it’s current yield:</p>
					<me>CY = \$ 100 \cdot \frac{5000 \cdot 0.04}{4950} = 4.0404</me>
				</example>
				<p>The computation above does not include any possible gains or losses if the bond were bought at a discount or premium. 
				Since the comparison of the bond price to its par value is a factor that affects the actual current yield, unless the
				purchaser pays par value for the bond then the above formula would give a slightly inaccurate picture. To correct this, 
				investors can modify the current yield formula by adding the result of the current yield to the gain or loss the price 
				gives the investor: [(Par Value – Bond Price)/Years to Maturity]. 
				The modified current yield formula then takes into account the discount or premium at which the investor bought the bond: </p>
				<me>CY = \$ 100 \cdot \frac{\text{Annual Coupon}}{\text{Market Price}} + 
				          \frac{\text{Maturity Value - Market Price}}{\text{Years Till Maturity}}</me>

				<example>
					<p>Suppose our bond above matures in 60 months and has a coupon payment of <m>\$ 10 </m>.  Then</p>
					<me>CY = \$ 10 \cdot \frac{10}{4950} + \frac{5000-4950}{5} = 10.2020</me>
					<p>The adjusted current yield of 10.20% is higher than the current yield of 4.04% because the bond's discounted price 
					(4950 instead of 5000) gives the investor more of a gain on the investment</p>
				</example>
			</subsection>
        </section>
        <section xml:id="EOV"><title>Equations of Value</title>
        <p>There are times that a series of debts owed by an individual might have need to be replaced
        with another set of debts with perhaps different amounts and at perhaps different times. To 
        determine how to set this up in an equitable manner requires an “equation of value”.  To create
        an equation of value, draw a time line with debts above and payments below.
        Choose a date to focus on (often a payment date) and then determine the value of all debts and
         payments at that time. Finally, set the value of payments = value of debts.</p>
			<example>
			  <p>Consider the situation where one owes a debt of <m>\$ 20000</m> in 4 years and 
			  <m>\$ 30000</m> in 8 years with
			  money compounded quarterly at a nominal rate of 8%. One 
			  might desire to combine these two debts into a single payment of size X, say, on the 6th year.
			  yields the following equation of value: 
						 <me>X = \$ 20000(1+0.08/4)^8 + \$ 30000(1+0.08/4)^{-8}</me>
			  and arithmetic easily yields <me>X = \$ 49037.90</me></p>
			</example>
			<example>
			  <p>Consider a situation similar to above but now where one owes the same debts of 
			  <m>\$ 20000</m> in 4 years and <m>\$ 30000</m> in 8 years with
			  money compounded quarterly at a nominal rate of 8% but with the desire to convert this to two 
			  payments each of size X, say, on the 6th year and 7th year. This
			  yields the following equation of value: 
						 <me>X + X(1+0.08/4)^{-4} = \$ 20000(1+0.08/4)^8 + \$ 30000(1+0.08/4)^{-8}</me>
			  and a little but of algebra and arithmetic yields <me>X = \$ 25489.50</me></p>
			</example>
			
			<subsection><title>Dollar-Weighted Rate of Return</title>
				<p>In general, for a sequence of investments starting with an initial investment of <m>V_0</m> at time 0 and
				subsequent investments (i.e. cash flows) of value <m>C_1, C_2, ... , C_n</m> at times 
				<m>t_1, t_2, ... , t_n</m> then the future value of these at time t is given by
				<me>A = V_0(1+r)^t + \sum_{k=1}^n C_k(1+r)^{t-t_k}</me>. One can approximate this
				equation with an easier one using “linearization” where one replaces  <m>(1+r)^t</m>
				with it’s first-order Taylor approximation <m>1+rt</m>. This gives
				<me>A = V_0(1+rt) + \sum_{k=1}^n C_k(1+r(t-t_k))</me> which is the future value of the 
				investments if only simple interest were used. Solving for the interest rate yields the 
				“dollar weighted rate of return” 
				<me>r = \frac{A - V_0 - \sum_{k=1}^n C_k}{V_0 t + \sum_{k=1}^n (t-t_k)C_k}</me>.
				For these, <m>V_0</m> can be thought of as the initial valance in the account and <m>C_k</m> 
				as deposits made at times <m>t_k</m>
				</p>
				<example><title>Dollar Weighted Rate of Return</title>
					<p>On January 1, 2000, the balance in an account is <m>\$ 25200</m>. On April 1, 2000, <m>\$500</m> 
					is deposited in this account and on July 1, 2001, a withdrawl of <m>\$ 1000</m> is made.
					The balance in the account on October 1, 2001 is <m>\$ 25900</m>. Determine the annual rate of 
					ionterest in this account according to the dollar-weighted method.</p>
					<p>So, the cashflow has the following:
					<me>
						\begin{matrix}
						 \text{Investment} &amp; 25200 &amp;  500 &amp; -1000 \\ 
						  \hline \\
						  \text{Time} &amp;  0  &amp; 3/12 &amp;  18/12 
						\end{matrix}					
					</me>
					with a future value of <m>A = \$ 25900</m>.  Therefore, the annual dollar-weighted
					rate of interest is
	<me>r = \frac{25900 - 25200 - 500 + 1000}{25200 (21/12) + 500 (18/12) - 1000 (3/12)} \approx 0.026906</me>.
					 </p>
				</example>
				<sage>
					<input>
pretty_print('Time Weighted Annual Rate of Return')
c=1
@interact
def _(n = slider(1,10,1,3,label='Number of Investment Changes')):
    @interact(layout=dict(top=[['M','FV'],['endtime']]))
    def __(M=('Investment / Time ', input_grid(2, n, default = [[25200,500,-1000,0,0,0,0,0,0,0],[0,3/12,18/12,2,3,4,5,6,7]])),
           FV = input_box(25900,label='Final Value',width=15),
           endtime = input_box(21/12,label='Final time (yrs)',width=8)):
        pretty_print(html('<center>State of Investments</center>'))
        
        Inv = M[0][0:n]
        times = M[1][0:n]
        A = matrix(QQ,[Inv,times])
        show(A)
        top = FV - Inv[0]
        bot = Inv[0]*endtime
        for k in range(1,n):
            top = top - Inv[k]
            bot = bot + Inv[k]*(endtime-times[k])
 
        r = (top/bot).n()
        pretty_print(html('<center>The Dollar-Weighted Rate of Return = %1.6f</center>'%r))
       
        
					</input>
				</sage>
        	</subsection>
        	
        	<subsection><title>Time-weighted annual rate of return</title>
				<p>Suppose now that we make investments into a fund over time and know the outstanding
				balance befoer each deposit or withdrawl occurs.  Notationally, let <m>B_0</m> be the
				initial balance in the fund and <m>B_k</m> the balance in the fund immediately before
				time <m>t_k</m> with <m>W_k</m> the amount of each deposit (if negative, then withdrawal).
				On a time line:
					<me>
\begin{matrix}
	\text{Time} &amp;  0  &amp; t_1 &amp; t_2 &amp; \ldots &amp; t_{n-1} &amp; t_n \\ 
	\hline \\
	\text{Balance Before} &amp; 0 &amp; B_1 &amp; B_2 &amp; ... &amp; B_{n-1} &amp; B_n \\
	\hline \\
	\text{Deposit/Withdrawal} &amp; 0 &amp; W_1 &amp; W_2 &amp; ... &amp; W_{n-1} &amp; W_n \\ 
	\hline \\
	\text{Balance After} &amp; B_0 &amp; B_1 + W_1 &amp; B_2 + W_2 &amp; ... &amp; B_{n-1} + W_{n-1} &amp; B_n + W_n \\ 
\end{matrix}					
					</me>
				</p>
        		<theorem><title>Time Weighted Annual Rate of Return Formula</title>
        		<statement>The “time-weighted annual rate of return” r is the solution of
        		<me>
        		(1+r)^{t_n} = \frac{B_1}{B_0} \cdot \frac{B_2}{B_1+W_1} \cdot \ldots \cdot \frac{B_n}{B_{n-1}+W_{n-1}}
        		</me>
        		</statement>
        		</theorem>
        		<proof>
        			<p>From the beginning of time, the growth over the first time period is given by
        			<m>B_1 = B_0(1+r_1)^{t_1}</m> or <me>\frac{B_1}{B_0} = (1+r_1)^{t_1}</me>. 
        			For subsequent time periods, the growth is given by 
        			<m>B_{k+1} = B_k(1+r_2)^{t_{k+1}-t_k}</m> or <me>\frac{B_{k+1}}{B_k} = (1+r_2)^{t_{k+1}-t_k}</me>.  
        			Multiplying these together yields
        			<md>
						<mrow>\frac{B_1}{B_0} \cdot \frac{B_2}{B_1} ... \cdot \frac{B_n}{B_{n-1}}</mrow>
						<mrow> &amp; = (1+r_1)^{t_1} \cdot (1+r_2)^{t_2-t_1} ... \cdot (1+r_n)^{t_n-t_{n-1}} </mrow>
						<mrow> &amp; = (1+r)^{t_n}</mrow>
        			</md>
        			noting that <m>r_k = r</m> for all k would allow all of the powers to cancel except for the last.
        			Define the time-weighted annual rate of return to be the value of r that makes this happen.
        			</p>
        		</proof>
        		<example>
        			<p>Consider the sequence of investments described in the table below:
					<me>
\begin{matrix}
	\text{Time} &amp; \text{11/1/16} &amp; \text{3/1/17} &amp; \text{8/1/17} &amp; \text{2/1/18} &amp; \text{4/1/18} \\ 
	\hline \\
	\text{Balance Before} &amp; \$ 14516 &amp; \$ 14547 &amp; \$ 18351 &amp; \$ 16969 &amp; \$ 18542 \\
	\hline \\
	\text{Deposit/Withdrawal} &amp; 0 &amp; \$ 3000 &amp; -\$ 2000 &amp; \$ 2500 &amp; 0 \\ 
\end{matrix}					
					</me>
					Then the time-weighted annual effective yield rate is given by
					<me>
        		(1+r)^{17/12} = \frac{14547}{14516} \cdot \frac{18351}{14547+3000} \cdot \frac{16969}{18351-2000} \cdot \frac{18524}{16969+2500} \approx 1.035877
					</me>      			
					and by solving yields <m> r \approx 0.025193371</m>
        			</p>
        		</example>
        		<sage>
        			<input>
pretty_print('Time Weighted Annual Rate of Return')

@interact
def _(n = slider(1,10,1,5,label='Number of Investment Changes')):
    
    head = '$ \\text{Times} \\rightarrow \\\ \\text{Bal Before} \\rightarrow \\\ \\text{Dep/Withdrawl} \\rightarrow $'

    @interact
    def __(M=(head, input_grid(3, n, default = [[0,4/12,9/12,15/12,17/12,4,5,6,7,8],[14516,14547,18351,16969,18542,1,1,1,1,1],[0,3000,-2000,2500,0,0,0,0,0,0]]))):
        
        pretty_print(html('<center>State of Investments</center>'))
        
        times = M[0][0:n]
        BalBefore = M[1][0:n]
        Inv = M[2][0:n]
        A = matrix(QQ,[times,BalBefore,Inv])
        show(A)
        s=1
        for k in range(n-1):
            s=s*BalBefore[k+1]/(Inv[k]+BalBefore[k]) 

        r = (e^(ln(s)/times[n-1])-1).n()
        pretty_print(html('<center>The Dollar-Weighted Rate of Return = %1.6f</center>'%r))
       
        
        
        			</input>
        		</sage>
        		
        	</subsection>
        </section>

    </article>

</mathbook>